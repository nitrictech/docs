---
description: 'How Nitric deploys APIs to AWS'
---

# AWS Resources - APIs

Nitric APIs are deployed to AWS using [Amazon API Gateway](https://aws.amazon.com/api-gateway/).

## AWS Resources

The following resources are created when deploying APIs to AWS:

- API Gateway v2 HTTP APIs
- API Gateway v2 Stages
- API Gateway Integration
- Lambda Functions
- ECR Images
- IAM Policies

## Deployment

During deployment the Nitric CLI builds your API's routes, methods and handlers:

- Files referenced by the `services` key in the `nitric.yaml` file are built into container images
- Built container images are pushed to the [Amazon Elastic Container Registry](https://aws.amazon.com/ecr/) as private images
- Functions in [AWS Lambda](https://aws.amazon.com/lambda/) are created to run the container images
- All route/handler mappings are built into an Open API v3 definition file (as required by Amazon API Gateway)
- Lambda ARNs are injected into the API definition using the [x-amazon-apigateway-integration object](https://docs.aws.amazon.com/apigateway/latest/developerguide/api-gateway-swagger-extensions-integration.html), creating an [API Gateway Integration](https://docs.aws.amazon.com/apigateway/api-reference/resource/integration/) for each.
- The API definition is deployed as an API Gateway v2 HTTP API, using the `$default` stage name
- IAM policies are created enabling API Gateway to execute the Lambdas

### Custom Domain Prerequisites

To support custom domains with APIs deployed to AWS your domain (or subdomain) will need to be setup as a [hosted zone](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zones-working-with.html) in Route 53.

The general steps to setup a hosted zone in Route 53 are as follows:

1. Navigate to Route 53 in the AWS Console
2. Select 'hosted zones' from the left navigation
3. Click 'Create hosted zone'
4. Enter your domain name and choose the 'Public hosted zone' type.
5. Click 'Create hosted zone'
6. You will now be provided with a set of NS DNS records to configure in the DNS provider for your domain
7. Create the required DNS records, then wait for the DNS changes to propagate

Once this is done you will be able to use the hosted zone domain or any direct subdomain with your Nitric APIs.

You can read more about how AWS suggests configuring hosted zones in their documentation on [Making Route 53 the DNS service for a domain that's in use](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/migrate-dns-domain-in-use.html) or [Making Route 53 the DNS service for an inactive domain](https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/migrate-dns-domain-inactive.html).

<Note>
  If the hosted zone was nitric.io, nitric.io or api.nitric.io would be
  supported for APIs, but not public.api.nitric.io since that is a subdomain of
  a subdomain.
</Note>

<Note>
  DNS propagation of the NS records can take a few seconds to a few hours due to
  the nature of DNS.
</Note>
