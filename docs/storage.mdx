---
description: 'Working with files and storage in Nitric'
---

# Storage

Nitric provides storage support for securely storing and retrieving large files in the cloud.

## Quick Start

Here's a minimal example to get you started:

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async function handleProfileImage() {
  // Upload a file
  await profiles.file('profile.png').write('image data')

  // Download a file
  const image = await profiles.file('profile.png').read()
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async function handleProfileImage() {
  // Upload a file
  await profiles.file('profile.png').write('image data')

  // Download a file
  const image = await profiles.file('profile.png').read()
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async def handle_profile_image():
  # Upload a file
  await profiles.file('profile.png').write(b'image data')

  # Download a file
  image = await profiles.file('profile.png').read()

Nitric.run()
```

```go !!
import (
  "context"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead, storage.BucketWrite)

// Use resources inside functions
func handleProfileImage(ctx context.Context) {
  // Upload a file
  _ = profiles.Write(ctx, "profile.png", []byte("image data"))

  // Download a file
  image, _ := profiles.Read(ctx, "profile.png")
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
  BucketPermission.write,
]);

// Use resources inside functions
Future<void> handleProfileImage() async {
  // Upload a file
  await profiles.file("profile.png").write("image data");

  // Download a file
  final image = await profiles.file("profile.png").read();
}
```

</CodeSwitcher>

## Core Concepts

### Buckets

Buckets are isolated repositories for files. Each bucket in your application needs a unique name and specific permissions for reading, writing, and deleting files.

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write', 'delete')
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write', 'delete')
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read', 'write', 'delete')

Nitric.run()
```

```go !!
import (
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead, storage.BucketWrite, storage.BucketDelete)

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
  BucketPermission.write,
  BucketPermission.delete,
]);
```

</CodeSwitcher>

### File References

You can get a reference to a file in a bucket using the `file()` method. This returns a `File` reference that you can use to perform operations on the file.

<Note>
  No network calls are made when you get a file reference using `file()`
</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function getProfilePicture() {
  const profilePicture = profiles.file('users/bruce-wayne/profile.png')
  return profilePicture
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function getProfilePicture() {
  const profilePicture = profiles.file('users/bruce-wayne/profile.png')
  return profilePicture
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read')

// Use resources inside functions
async def get_profile_picture():
  profile_picture = profiles.file('users/bruce-wayne/profile.png')
  return profile_picture

Nitric.run()
```

```go !!
import (
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead)

// Go does not have File references use methods on the Bucket reference directly
func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
]);

// Use resources inside functions
Future<File> getProfilePicture() async {
  final profilePicture = profiles.file("users/bruce-wayne/profile.png");
  return profilePicture;
}
```

</CodeSwitcher>

## Features

### Reading Files

Read file contents using the `read()` method:

<Note>
  If a file doesn't exist when `read()` is called, a `NOT_FOUND` error will be
  thrown.
</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function readProfileImage() {
  const image = await profiles.file('profile.png').read()
  return image
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function readProfileImage() {
  const image = await profiles.file('profile.png').read()
  return image
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read')

// Use resources inside functions
async def read_profile_image():
  image = await profiles.file('profile.png').read()
  return image

Nitric.run()
```

```go !!
import (
  "context"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead)

// Use resources inside functions
func readProfileImage(ctx context.Context) ([]byte, error) {
  return profiles.Read(ctx, "profile.png")
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
]);

// Use resources inside functions
Future<List<int>> readProfileImage() async {
  final image = await profiles.file("profile.png").read();
  return image;
}
```

</CodeSwitcher>

### Writing Files

Write file contents using the `write()` method. If the file doesn't exist, it will be created. If it does exist, it will be overwritten.

<Note>
  Written data cannot exceed 4MB. For larger files, use [signed
  URLs](#signed-urls).
</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('write')

// Use resources inside functions
async function writeProfileImage() {
  await profiles.file('profile.png').write('image data')
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('write')

// Use resources inside functions
async function writeProfileImage() {
  await profiles.file('profile.png').write('image data')
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('write')

// Use resources inside functions
async def write_profile_image():
  await profiles.file('profile.png').write(b'image data')

Nitric.run()
```

```go !!
import (
  "context"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketWrite)

// Use resources inside functions
func writeProfileImage(ctx context.Context) error {
  return profiles.Write(ctx, "profile.png", []byte("image data"))
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.write,
]);

// Use resources inside functions
Future<void> writeProfileImage() async {
  await profiles.file("profile.png").write("image data");
}
```

</CodeSwitcher>

### Deleting Files

Delete files using the `delete()` method:

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('delete')

// Use resources inside functions
async function deleteProfileImage() {
  await profiles.file('profile.png').delete()
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('delete')

// Use resources inside functions
async function deleteProfileImage() {
  await profiles.file('profile.png').delete()
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('delete')

// Use resources inside functions
async def delete_profile_image():
  await profiles.file('profile.png').delete()

Nitric.run()
```

```go !!
import (
  "context"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketDelete)

// Use resources inside functions
func deleteProfileImage(ctx context.Context) error {
  return profiles.Delete(ctx, "profile.png")
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.delete,
]);

// Use resources inside functions
Future<void> deleteProfileImage() async {
  await profiles.file("profile.png").delete();
}
```

</CodeSwitcher>

### Listing Files

List all files in a bucket using the `files()` method:

<Note>A network call is made when you list files using `files()`</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function listProfileImages() {
  const files = await profiles.files()
  files.forEach((file) => {
    console.log(file.name)
  })
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read')

// Use resources inside functions
async function listProfileImages() {
  const files = await profiles.files()
  files.forEach((file) => {
    console.log(file.name)
  })
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read')

// Use resources inside functions
async def list_profile_images():
  files = await profiles.files()
  for file in files:
    print(file.name)

Nitric.run()
```

```go !!
import (
  "context"
  "fmt"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead)

// Use resources inside functions
func listProfileImages(ctx context.Context) error {
  files, err := profiles.ListFiles(ctx)
  if err != nil {
    return err
  }
  for _, file := range files {
    fmt.Println(file)
  }
  return nil
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
]);

// Use resources inside functions
Future<void> listProfileImages() async {
  final files = await profiles.files();
  await Future.wait(files.map((file) async {
    print(file.key);
  }));
}
```

</CodeSwitcher>

### Signed URLs

Generate temporary URLs for downloading or uploading files. These URLs include authentication information and are useful for sharing temporary links.

<Note>
  Anyone with the signed URL can access or modify the file. Only share URLs with
  trusted users.
</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async function getSignedUrls() {
  const downloadUrl = await profiles.file('profile.png').getDownloadUrl({
    expiry: 3600, // Expires in 1 hour
  })

  const uploadUrl = await profiles.file('profile.png').getUploadUrl({
    expiry: 3600, // Expires in 1 hour
  })

  return { downloadUrl, uploadUrl }
}
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async function getSignedUrls() {
  const downloadUrl = await profiles.file('profile.png').getDownloadUrl({
    expiry: 3600, // Expires in 1 hour
  })

  const uploadUrl = await profiles.file('profile.png').getUploadUrl({
    expiry: 3600, // Expires in 1 hour
  })

  return { downloadUrl, uploadUrl }
}
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles').allow('read', 'write')

// Use resources inside functions
async def get_signed_urls():
  download_url = await profiles.file('profile.png').download_url(3600)  # Expires in 1 hour
  upload_url = await profiles.file('profile.png').upload_url(3600)      # Expires in 1 hour
  return {'download_url': download_url, 'upload_url': upload_url}

Nitric.run()
```

```go !!
import (
  "context"
  "time"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles").Allow(storage.BucketRead, storage.BucketWrite)

// Use resources inside functions
func getSignedUrls(ctx context.Context) (string, string, error) {
  downloadUrl, err := profiles.DownloadUrl(ctx, "profile.png", storage.WithPresignUrlExpiry(time.Hour))
  if err != nil {
    return "", "", err
  }
  uploadUrl, err := profiles.UploadUrl(ctx, "profile.png", storage.WithPresignUrlExpiry(time.Hour))
  if err != nil {
    return "", "", err
  }
  return downloadUrl, uploadUrl, nil
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles").allow([
  BucketPermission.read,
  BucketPermission.write,
]);

// Use resources inside functions
Future<Map<String, String>> getSignedUrls() async {
  final downloadUrl = await profiles.file("profile.png").getDownloadUrl(
    expiry: 3600 // Expires in 1 hour
  );

  final uploadUrl = await profiles.file("profile.png").getUploadUrl(
    expiry: 3600 // Expires in 1 hour
  );

  return {
    'downloadUrl': downloadUrl,
    'uploadUrl': uploadUrl,
  };
}
```

</CodeSwitcher>

### Bucket Notifications

Subscribe to changes in your bucket's files. You can filter notifications by file prefix and event type (write/delete).

<Note>
  Writing/Deleting to a bucket from within a bucket notification will trigger
  the same notification again, potentially causing an infinite loop.
</Note>

<CodeSwitcher tabs>

```javascript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles')

// Use resources inside functions
profiles.on('write', '/users/images', (ctx) => {
  console.log(`New profile image for ${ctx.req.key} was created`)
})
```

```typescript !!
import { bucket } from '@nitric/sdk'

// Declare resources at the module level
const profiles = bucket('profiles')

// Use resources inside functions
profiles.on('write', '/users/images', (ctx) => {
  console.log(`New profile image for ${ctx.req.key} was created`)
})
```

```python !!
from nitric.resources import bucket
from nitric.application import Nitric

// Declare resources at the module level
profiles = bucket('profiles')

// Use resources inside functions
@profiles.on("write", "/users/images")
async def image_written(ctx):
  print(f"New profile image for {ctx.req.key} was written")

Nitric.run()
```

```go !!
import (
  "fmt"
  "github.com/nitrictech/go-sdk/nitric"
  "github.com/nitrictech/go-sdk/nitric/storage"
)

// Declare resources at the module level
var profiles = nitric.NewBucket("profiles")

// Use resources inside functions
func init() {
  profiles.On(storage.WriteNotification, "/users/images", func(ctx *storage.Ctx) {
    fmt.Printf("New profile image for %s was written", ctx.Request.Key())
  })
}

func main() {
  nitric.Run()
}
```

```dart !!
import 'package:nitric_sdk/nitric.dart';

// Declare resources at the module level
final profiles = Nitric.bucket("profiles");

// Use resources inside functions
void setupNotifications() {
  profiles.on(BlobEventType.write, "/users/images", (ctx) async {
    print("New profile image for ${ctx.req.key} was written");
    return ctx;
  });
}
```

</CodeSwitcher>

## Cloud Service Mapping

Each cloud provider comes with a set of default services used when deploying resources. You can find the default services for each cloud provider below.

- [AWS](/providers/mappings/aws/storage)
- [Azure](/providers/mappings/azure/storage)
- [Google Cloud](/providers/mappings/gcp/storage)
